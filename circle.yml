machine:
  java:
    version: openjdk8
    
dependencies: 
  override:
    - echo 'Skipping Dependency Check'

test:
  pre:
    - wget http://nasdanika.org/winstone-0.9.10.jar
    - cd org.nasdanika.bank.aggregator && mvn package javadoc:aggregate
    
  override:
    - pwd
    - cd org.nasdanika.bank.aggregator && mvn verify
    
  post:
    - pwd
    - java -jar winstone-0.9.10.jar --webroot=org.nasdanika.repository/target/repository --controlPort=8081
        background: true
    - sleep 5
    - cd org.nasdanika.bank.product && mvn package
    - pwd
    - java -cp winstone-0.9.10.jar winstone.tools.WinstoneControl shutdown
    
deployment:
  staging:
    branch: master
    commands:
    - mv org.nasdanika.repository/target/products/org.nasdanika.bank.product-*.zip $CIRCLE_ARTIFACTS    
